{% extends 'base.html.twig' %}

{% block title %}Panier
{% endblock %}

{% block body %}
	<h1>Panier</h1>
	{% set sum = 0 %}
	{% set sumT = 0 %}
	{% set reduce = 0 %}

	{% if cart|length > 0 %}
		<table>
			<thead>
				<tr>
					<th>Produit</th>
					<th>Prix</th>
					<th>Quantité</th>
					<th>Total</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{% for productId, item in cart %}
					{% set sum = sum + item.price * item.quantity %}
					<tr>
						<td>{{ item.productName }}</td>
						<td>{{ item.price }}
							€</td>
						<td>{{ item.quantity }}</td>
						<td>{{ item.price * item.quantity }}
							€</td>
						<td>
							<form action="{{ path('app_cart_update', {productId: productId}) }}" method="post">
								<div class="quantity" data-controller="quantity">
									<button data-action="click->quantity#decrement" class="minus">-</button>
									<input type="number" name="quantity" data-quantity-target="quantity" value="{{ item.quantity }}" class="quantity-value" min="1">
									<button data-action="click->quantity#increment" class="minus">+</button>
									<button type="submit">Mettre à jour</button>
								</div>
							</form>
							<a href="{{ path('app_cart_remove', {productId: productId}) }}">
								<i class="fa-solid fa-trash"></i>
							</a>
						</td>
					</tr>
				{% endfor %}

			</tbody>
		</table>
		<h3>Total :
			<span id="cart-total">{{ sum }}
				€</span>
		</h3>

		{# Formulaire de réduction #}
		<form action="{{ path('app_cart_discount') }}" method="post" data-controller="discount" data-action="submit->discount#applyDiscount">
			{{ form_start(discountForm) }}
			{{ form_row(discountForm.discount) }}
			{{ form_end(discountForm) }}
		</form>

		<a href="{{ path('app_cart_clear') }}">Vider le panier</a>

	{% else %}
		<p>Votre panier est vide</p>
	{% endif %}
{% endblock %}
