{% extends 'base.html.twig' %}

{% block title %}Panier
{% endblock %}

{% block body %}
	<div class="cart">
		<h1 class="cart-title">Panier</h1>
		{% set sum = 0 %}
		{% set sumT = 0 %}
		{% set reduce = 0 %}

		<form action="" method='POST' data-controller="discount">
			<section class="cart-customer">
				<label for="customers" class="p-product">Choix du client:</label>
				<select id="customers" name="customers" data-action="change->discount#updateDiscount" class="discount-choice">
					<option value="" disabled selected>Sélection</option>
					{% for customer in customers %}
						<option value="{{ customer.id }}" data-discount="{{ customer.type.discount }}">{{customer.lastname }}
							{{ customer.firstname }}</option>
					{% endfor %}
				</select>

				<label for="discount">Réduction de base à appliquer au client:</label>
				<p id="discount" data-discount-target="discount">Pas de réduction</p>
			</section>

			<p class="p-total-product">Vous avez
				{{ totalProducts }}
				articles dans votre panier</p>

			{% if cart|length > 0 %}
				<table>
					<thead>
						<tr>
							<th>Produit</th>
							<th>Prix</th>
							<th>Quantité</th>
							<th>Total</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for productId, item in cart %}
							{% set sum = sum + item.price * item.quantity %}
							{% set sumT = sumT + item.price * item.quantity %}
							<tr class="cart-body">
								<th>{{ item.productName }}</th>
								<td>{{ item.price }}
									€</td>
								<td>{{ item.quantity }}</td>
								<td>{{ item.price * item.quantity }}
									€</td>
								<td class="action">
									<form action="{{ path('app_cart_update', {productId: productId}) }}" method="post">
										<div class="quantity" data-controller="quantity">
											<button data-action="click->quantity#decrement" class="minus">-</button>
											<input type="number" name="quantity" data-quantity-target="quantity" value="{{ item.quantity }}" class="quantity-value" min="1">
											<button data-action="click->quantity#increment" class="minus">+</button>
											<button class="no-button" type="submit">
												<i class="fa-solid fa-check"></i>
											</button>
										</div>
									</form>
									<a href="{{ path('app_cart_remove', {productId: productId}) }}" class="action-trash">
										<i class="fa-solid fa-trash"></i>
									</a>
								</td>
							</tr>
						{% endfor %}

						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td>Sous-Total</td>
							<td>{{ sumT }}
								€</td>
						</tr>
					</tbody>
				</table>

				{# Formulaire de réduction #}
				<form action="{{ path('app_cart_discount') }}" method="post" data-controller="discount" data-action="submit->discount#applyDiscount" class="discount-form">
					{{ form_start(discountForm) }}
					{{ form_label(discountForm.discount) }}
					{{ form_errors(discountForm.discount) }}
					{{ form_widget(discountForm.discount, {'attr': {'class': 'discount-choice', 'data-discount-target': 'discount'}}) }}
					{{ form_row(discountForm.apply, {'attr': {'class': 'fa-solid fa-check no-button'}}) }}
					{{ form_end(discountForm) }}
				</form>

				<h3 class="cart-total">Total :
					<span id="cart-total">{{ sum }}
						€</span>
				</h3>

				{# Formulaire pour le paiement #}
				<form action="" method="POST">
					<section class="cart-customer">
						<p class="p-product">Moyen de paiement:</p>
						<div class="cart-payement">
							<div><input type="radio" id="cb" name="payement" value="carte bancaire">
								<label for="cb" class="p-payement">CB</label>
							</div>
							<div><input type="radio" id="espece" name="payement" value="espèce">
								<label for="espece" class="p-payement">Espèce</label>
							</div>
							<div><input type="radio" id="virement" name="payement" value="virement">
								<label for="virement" class="p-payement">Virement</label>
							</div>
							<div><input type="radio" id="cheque" name="payement" value="chèque">
								<label for="cheque" class="p-payement">Chèque</label>
							</div>
						</div>
					</section>
				</form>
			</form>
			<div class="twobuttons">
				<a href="{{ path('app_cart_clear') }}" class="add-button-customer">Vider le panier</a>
			</div>

		{% else %}
			<p class="p-product">Votre panier est vide</p>
		{% endif %}
	</div>
{% endblock %}
